"use strict";(self.webpackChunkmartime_web_app=self.webpackChunkmartime_web_app||[]).push([[408],{7408:(e,n,t)=>{t.r(n),t.d(n,{buildThreeDRendering:()=>G});var i=t(9477),o=t(3867),s=t(4458),r=t(5786),a=t(5484),l=t(7531),c=t(3660),d=t(2644),h=t(2531),u=t(6623),m=t(7052),w=t(6456),v=t(698),f=t(6388),p=t(9755);function g(e,n){const t=e.position.subtract(n.position);return f.yS(h.v2(t.angle),h.v2(e.vector.angle))}function b(e,n){const t=n.position.subtract(e.position);return f.yS(h.v2(t.angle),h.v2(n.vector.angle))}function P(e,n){return Math.random()*(n-1-e+1)+e}var S=t(9755);let y,C,M,k,x,N,D,E,z;const T={sunriseElevation:2,sunsetElevation:178,elevation:null,azimuth:90};let W,O=Date.now();const R=1e3/30;let I,H,L=new i.ZAu;L.name="buoys";const V=1e3;let F=!1,_=0;const j=new i.vBJ({color:"black"}),B={};C=new i.xsS,y=new i.cPb(55,window.innerWidth/window.innerHeight,1,2e4),y.position.set(30,30,100);const X=new i.mTL,Y=new i.SJI;switch(y.add(Y),u.f.environment){case"day":T.elevation=P(T.sunriseElevation,T.sunsetElevation),console.log(T.elevation),H=!1;break;case"night":T.elevation=P(T.sunriseElevation,-T.sunsetElevation),console.log(T.elevation),H=!0}var $=new o.E;const A={PDV:"assets/pdv-fog-signal.mp3",SV:"assets/lame-duck-fog-signal.mp3",VEIF:"assets/lame-duck-fog-signal.mp3",NUC:"assets/lame-duck-fog-signal.mp3",RAM:"assets/lame-duck-fog-signal.mp3",anchorless100m:"assets/at-anchor-less-than-100m.mp3"},U=(e,n,t,o,s,r)=>new Promise(((a,l)=>{$.load(e,(function(e){let l=e.scene;l.position.set(te(n),0,te(t)),l.rotation.y=-o,l.name=s,"resVis"===u.f.environment?X.load(re(r),(function(e){const n=new i.VYz(Y);n.setBuffer(e),n.setRefDistance(10),n.setLoop(!0),"PDV"==r&&(n.offset=Math.random()),l.add(n),C.add(l)})):C.add(l),a("success")}),void 0,(function(e){l(e)}))})),q=(e,n,t,i,o)=>new Promise(((s,r)=>{$.load(e,(function(e){let r=e.scene;r.position.set(te(n),0,te(t)),r.name=i,r.number=o,r.flashInterval=1e3,r.flashLength=V,r.lightOn=!0,L.add(r),s("success")}),void 0,(function(e){r(e)}))}));function G(){y.rotation.y=-u.a6[0].course-Math.PI/2,S("#base-wrapper").css("transform","rotate("+Math.round(180*u.a6[0].course/Math.PI+90)+"deg)");const e=new Promise(((e,n)=>{(async()=>{try{const n=[];u.a6.slice(1).forEach((e=>{n.push(U("assets/"+e.type+".glb",e.relposXnm,e.relposYnm,e.course,e.name,e.type))})),u.NC&&(u.NC.markers.relPositionsPort.forEach(((e,t)=>{n.push(q("assets/portMarker.glb",e.x,e.y,`port_marker_${t}`,t))})),u.NC.markers.relPositionsStarboard.forEach(((e,t)=>{n.push(q("assets/stbMarker.glb",e.x,e.y,`starboard_marker_${t}`,t))})));const t=await Promise.all(n);u.NC&&C.add(L),e(t)}catch(e){n(e)}})()})),n=new Promise(((e,n)=>{M=new i.CP7({canvas:ThreeDcanvas}),M.setPixelRatio(window.devicePixelRatio),M.setSize(window.innerWidth,window.innerHeight),M.toneMapping=i.LY2,C=new i.xsS;const t=new s.C(C,y);x=new i.Pa4;const o=new i._12(1e5,1e5);k=new c.B(o,{textureWidth:512,textureHeight:512,waterNormals:(new i.dpR).load("assets/waternormals.jpg",(function(e){e.wrapS=e.wrapT=i.rpg})),sunDirection:new i.Pa4,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==C.fog}),k.rotation.x=-Math.PI/2,C.add(k);const m=new d.q;m.scale.setScalar(1e4),C.add(m);const w=m.material.uniforms;w.turbidity.value=10,w.rayleigh.value=2,w.mieCoefficient.value=.005,w.mieDirectionalG.value=.8;const v=new i.anP(M);let f;"resVis"===u.f.environment&&(w.mieCoefficient.value=.8,w.mieDirectionalG.value=.5,C.fog=new i.ybr(4737097,1e3,1100),T.elevation=55.23),function(){const e=i.M8C.degToRad(90-T.elevation),n=i.M8C.degToRad(T.azimuth);x.setFromSphericalCoords(1,e,n),m.material.uniforms.sunPosition.value.copy(x),k.material.uniforms.sunDirection.value.copy(x).normalize(),k.material.blendDst=2,void 0!==f&&f.dispose(),f=v.fromScene(m),C.environment=f.texture}(),N=new a.m(new i.FM8(window.innerWidth,window.innerHeight),1.5,.4,.85),N.threshold=0,N.strength=5,N.radius=1,D=new r.x(M),D.renderToScreen=!1,D.addPass(t),D.addPass(N),z=new l.T(new i.jyz({uniforms:{baseTexture:{value:null},bloomTexture:{value:D.renderTarget2.texture}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,defines:{}}),"baseTexture"),z.needsSwap=!0,E=new r.x(M),E.addPass(t),E.addPass(z),window.addEventListener("resize",(()=>{M.setSize(window.innerWidth,window.innerHeight),y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),D.setSize(window.innerWidth,window.innerHeight),E.setSize(window.innerWidth,window.innerHeight)})),window.addEventListener("orientationchange",(()=>{M.setSize(window.innerWidth,window.innerHeight),y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),D.setSize(window.innerWidth,window.innerHeight),E.setSize(window.innerWidth,window.innerHeight)})),S("#course-display").append(`<p>${h.UN(h.v2(u.a6[0].vector.angle).toFixed(1))}&deg;</p>`),S("#speed-display").append(`<p>${u.a6[0].speed.toFixed(1)} Kts</p>`),e("success"),n("Error during intialization"),console.log(C)}));(async()=>{try{await Promise.all([e,n]),function(e){e||C.traverse((e=>{e.name.includes("light")&&(e.visible=!1)}))}(H),J(),S(".threeOverlay").hide()}catch(e){console.log(e)}})()}function J(){if(requestAnimationFrame(J),!0===u.f.play&&(W=Date.now(),I=W-O,I>R&&(O=W-I%R,function(e,n,t,i,o){const s=e/1e3;if(1==n.play){if(v.NX(project,n.centX,n.centY,n.onemile),i){const e=s/(60*t[0].vector.length);let n=t[0].vector.multiply(e);n.angle=t[0].vector.angle-180;const o=i.trafficLanes.occupied.position.add(n);m.Fd(o,i),v.Et(i)}if(o){const e=s/(60*t[0].vector.length);let i=t[0].vector.multiply(e);i.angle=t[0].vector.angle-180;const r=o.lanes.occupied.position.add(i);w.Fd(r,o),o.markers.relPositionsPort=w.Wc(o.markers.portMarkers,t[0].position,n.onemile),o.markers.relPositionsStarboard=w.Wc(o.markers.starboardMarkers,t[0].position,n.onemile),v.JX(o,n.onemile,n.centX,n.centY)}v.fb(t[0],n.shipVctrLngth,n.onemile);for(var r=0;r<t.length;r++){var a=t[r];if("Own Ship"!=a.type){let e=s/(60*n.shipVctrLngth),i=a.relVec.multiply(e);a.position=a.position.add(i),a.vecEnd=a.vecEnd.add(i),a.vecOwnShip=a.position.subtract(t[0].position),a.OwnShipAngle=a.vecOwnShip.angle,a.relposXnm=h.KO(a.vecOwnShip.x,n.onemile),a.relposYnm=h.KO(a.vecOwnShip.y,n.onemile),a.USNRel=g(a,t[0]),a.USNRelFrmOwnShp=b(a,t[0]),f.fA(a,t[0],n.shipVctrLngth,n.onemile),p("#radar").is(":visible")&&v.fb(a,n.shipVctrLngth,n.onemile)}}}}(R,u.f,u.a6,u.Et,u.NC),S("#lookOut").is(":visible")))){H&&ie(),performance.now(),k.material.uniforms&&(k.material.uniforms.time.value+=1/60),M.render(C,y),ie(),E.render(),F?(y.fov=20,y.updateProjectionMatrix()):(y.fov=45,y.updateProjectionMatrix()),y.rotation.y+=_,function(){let e=new i.Pa4;y.getWorldDirection(e);let n=Math.atan2(e.z,e.x)+Math.PI/2;n<0&&(n+=2*Math.PI),ne=Math.round(180*n/Math.PI);let t=[n-.035,n-.0175,n,n+.0175,n+.035];t.forEach((function(e,n){e<0&&(e+=2*Math.PI);let i=Math.round(180*e/Math.PI);t[n]=h.UN(i)})),S("#orientator").css("transform","rotate("+t[2]+"deg)"),S("#vis-bearing").text(""),t[2]="<span id=fcsBrng>"+t[2]+"</span>",S("#vis-bearing").append(t.join("  "))}();for(let e=2;e<C.children.length;e++){if(C.children[e].name.startsWith("00")){let n=C.children[e].name,t=Q(n);if(C.children[e].position.set(te(u.a6[t].relposXnm),0,te(u.a6[t].relposYnm)),H&&Z(t,C.children[e]),K(t,C.children[e]),n="003"){const n=C.children[e].children[C.children[e].children.length-1];0==n.isPlaying&&n.play()}}if(u.NC&&"buoys"==C.children[e].name)for(let n=0;n<C.children[e].children.length;n++){const t=C.children[e].children[n].number;C.children[e].children[n].name.startsWith("port")?Math.sqrt(Math.pow(u.NC.markers.relPositionsPort[t].x,2)+Math.pow(u.NC.markers.relPositionsPort[t].y,2))>11?C.children[e].children[n].visible=!1:(C.children[e].children[n].visible=!0,C.children[e].children[n].position.set(te(u.NC.markers.relPositionsPort[t].x),0,te(u.NC.markers.relPositionsPort[t].y))):C.children[e].children[n].name.startsWith("starboard")&&(Math.sqrt(Math.pow(u.NC.markers.relPositionsStarboard[t].x,2)+Math.pow(u.NC.markers.relPositionsStarboard[t].y,2))>11?C.children[e].children[n].visible=!1:(C.children[e].children[n].visible=!0,C.children[e].children[n].position.set(te(u.NC.markers.relPositionsStarboard[t].x),0,te(u.NC.markers.relPositionsStarboard[t].y)))),1==C.children[e].children[n].visible&&H&&ee(C.children[e].children[n])}}}}function K(e,n){u.a6[e].range>11?n.visible=!1:n.visible=!0}function Z(e,n){const t=u.a6[e].USNRel;n.traverse((e=>{e.name.includes("SG")&&(t>0&&t<112.5||t>354&&t<360)&&(e.visible=!0),e.name.includes("SG")&&t>112.5&&t<354&&(e.visible=!1),e.name.includes("SR")&&(t>247.5&&t<360||t>0&&t<4)&&(e.visible=!0),e.name.includes("SR")&&t>4&&t<247.5&&(e.visible=!1),e.name.includes("MH")&&(t>247.5&&t<360||t>0&&t<112.5)&&(e.visible=!0),e.name.includes("MH")&&t>112.5&&t<247.5&&(e.visible=!1),e.name.includes("STRN")&&t>112.5&&t<247.5&&(e.visible=!0),e.name.includes("STRN")&&t>0&&t<112.5&&(e.visible=!1),e.name.includes("STRN")&&t>247.5&&t<360&&(e.visible=!1)}))}function Q(e){return u.a6.findIndex((function(n){return n.name==e}))}function ee(e){e.lastSwitch||function(e){const n=Math.random()*V;e.lastSwitch=Date.now()-n}(e);const n=Date.now()-e.lastSwitch;e.lightOn&&n>e.flashLength?e.traverse((n=>{n.name.includes("light")&&(n.visible=!1),e.lightOn=!1,e.lastSwitch=Date.now()})):!e.lightOn&&n>e.flashInterval&&e.traverse((n=>{n.name.includes("light")&&(n.visible=!0),e.lightOn=!0,e.lastSwitch=Date.now()}))}let ne="";function te(e){return 1e3*e}function ie(e){C.traverse(oe),D.render(),C.traverse(se)}function oe(e){e.isMesh&&!e.name.includes("light")&&(B[e.uuid]=e.material,e.material=j)}function se(e){B[e.uuid]&&(e.material=B[e.uuid],delete B[e.uuid])}const re=function(e){return A[e]};S((function(){S("#zoom-view").on("touchstart mousedown",(function(){F=!0,S("#zoom-view").addClass("view-selected"),S("#eye-view").removeClass("view-selected"),S("#compass-view").removeClass("view-selected"),S("#compass-cont").is(":visible")&&S("#compass-cont").toggle(),S("#instrument-panel").is(":visible")||S("#instrument-panel").toggle(),S("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),S("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),S("#eye-view").on("touchstart mousedown",(function(){F=!1,S("#eye-view").addClass("view-selected"),S("#zoom-view").removeClass("view-selected"),S("#compass-view").removeClass("view-selected"),S("#compass-cont").is(":visible")&&S("#compass-cont").toggle(),S("#instrument-panel").is(":visible")||S("#instrument-panel").toggle(),S("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),S("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),S("#compass-view").on("touchstart mousedown",(function(){F=!1,S("#eye-view").removeClass("view-selected"),S("#zoom-view").removeClass("view-selected"),S("#compass-view").addClass("view-selected"),S("#compass-cont").is(":visible")||S("#compass-cont").toggle(),S("#instrument-panel").is(":visible")&&S("#instrument-panel").toggle(),le(!0),S("#left-arrow i").addClass("fa-regular fa-chevron-left").removeClass("fa-duotone fa-chevrons-left"),S("#right-arrow i").addClass("fa-regular fa-chevron-right").removeClass("fa-duotone fa-chevrons-right")})),S("#left-arrow").on("hover",(function(e){S(this).css("color","rgba(255, 255, 255, 1)")}),(function(){S(this).css("color","rgba(255, 255, 255, 0.75)")})),S("#left-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),S("#compass-cont").is(":visible")?(_=9e-4,le()):_=.01,S(this).css("color","rgba(255, 255, 255, 1)")})),S("#left-arrow").on("touchend mouseup",(function(e){e.preventDefault(),_=0,S(this).css("color","rgba(255, 255, 255, 0.75)")})),S(document).on("keydown",(function(e){37==e.which&&(S("#compass-cont").is(":visible")?(_=9e-4,le()):_=.01)})),S(document).on("keyup",(function(e){37==e.which&&(_=0)})),S("#right-arrow").on("hover",(function(e){S(this).css("color","rgba(255, 255, 255, 1)")}),(function(){S(this).css("color","rgba(255, 255, 255, 0.75)")})),S("#right-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),S("#compass-cont").is(":visible")?(_=-9e-4,le()):_=-.01,S(this).css("color","rgba(255, 255, 255, 1)")})),S("#right-arrow").on("touchend mouseup",(function(e){e.preventDefault(),_=0,S(this).css("color","rgba(255, 255, 255, 0.75)")})),S(document).on("keydown",(function(e){39==e.which&&(S("#compass-cont").is(":visible")?(_=-9e-4,le()):_=-.01)})),S(document).on("keyup",(function(e){39==e.which&&(_=0)})),S("#lookout-button").on("touchstart mousedown",(function(){le(),console.log("Fired play audio"),C.traverse((e=>{"Audio"==e.type&&(console.log(e),e.context.resume())}))}))}));let ae="";const le=function(e){const n=ae;ae=Date.now();const t=ae-n;u.a6.slice(1).forEach((i=>{const o=Math.abs(h.v2(Math.round(i.vecOwnShip.angle))-ne);t>1e3&&o<3&&(console.log(`bearingDiff = ${o} | dwellTime = ${t} |  actualBearing = ${i.bearing}`),i.bearingsTaken.push(n)),e&&o<4&&i.bearingsTaken.push(ae)}))}}}]);
//# sourceMappingURL=408.bundle.js.map