"use strict";(self.webpackChunkmartime_web_app=self.webpackChunkmartime_web_app||[]).push([[646],{499:(e,n,t)=>{t.r(n),t.d(n,{buildThreeDRendering:()=>V});var i=t(9477),o=t(3867),s=t(4458),a=t(5786),r=t(5484),l=t(7531),c=t(3660),d=t(2644),u=t(2531),h=t(5443);function m(e,n){return Math.random()*(n-1-e+1)+e}var w=t(9755);let v,f,g,p,b,P,C,y,S;const M={sunriseElevation:2,sunsetElevation:178,elevation:null,azimuth:90};let x,k=Date.now();const D=1e3/30;let N,z,E=new i.ZAu;E.name="buoys";const T=1e3;let W=!1,I=0;const H=new i.vBJ({color:"black"}),R={};f=new i.xsS,v=new i.cPb(55,window.innerWidth/window.innerHeight,1,2e4),v.position.set(30,30,100);const _=new i.mTL,O=new i.SJI;switch(v.add(O),h.f.environment){case"day":M.elevation=m(M.sunriseElevation,M.sunsetElevation),console.log(M.elevation),z=!1;break;case"night":M.elevation=m(M.sunriseElevation,-M.sunsetElevation),console.log(M.elevation),z=!0}var j=new o.E;const B={PDV:"assets/pdv-fog-signal.mp3",SV:"assets/lame-duck-fog-signal.mp3",VEIF:"assets/lame-duck-fog-signal.mp3",NUC:"assets/lame-duck-fog-signal.mp3",RAM:"assets/lame-duck-fog-signal.mp3",anchorless100m:"assets/at-anchor-less-than-100m.mp3"},F=(e,n,t,o,s,a)=>new Promise(((r,l)=>{j.load(e,(function(e){let l=e.scene;l.position.set(J(n),0,J(t)),l.rotation.y=-o,l.name=s,"resVis"===h.f.environment?_.load(Q(a),(function(e){const n=new i.VYz(O);n.setBuffer(e),n.setRefDistance(10),n.setLoop(!0),"PDV"==a&&(n.offset=Math.random()),l.add(n),f.add(l)})):f.add(l),r("success")}),void 0,(function(e){l(e)}))})),L=(e,n,t,i,o)=>new Promise(((s,a)=>{j.load(e,(function(e){let a=e.scene;a.position.set(J(n),0,J(t)),a.name=i,a.number=o,a.flashInterval=1e3,a.flashLength=T,a.lightOn=!0,E.add(a),s("success")}),void 0,(function(e){a(e)}))}));function V(){v.rotation.y=-h.a6[0].course-Math.PI/2,w("#base-wrapper").css("transform","rotate("+Math.round(180*h.a6[0].course/Math.PI+90)+"deg)");const e=new Promise(((e,n)=>{(async()=>{try{const n=[];h.a6.slice(1).forEach((e=>{n.push(F("assets/"+e.type+".glb",e.relposXnm,e.relposYnm,e.course,e.name,e.type))})),h.NC&&(h.NC.markers.relPositionsPort.forEach(((e,t)=>{n.push(L("assets/portMarker.glb",e.x,e.y,`port_marker_${t}`,t))})),h.NC.markers.relPositionsStarboard.forEach(((e,t)=>{n.push(L("assets/stbMarker.glb",e.x,e.y,`starboard_marker_${t}`,t))})));const t=await Promise.all(n);h.NC&&f.add(E),e(t)}catch(e){n(e)}})()})),n=new Promise(((e,n)=>{g=new i.CP7({canvas:ThreeDcanvas}),g.setPixelRatio(window.devicePixelRatio),g.setSize(window.innerWidth,window.innerHeight),g.toneMapping=i.LY2,f=new i.xsS;const t=new s.C(f,v);b=new i.Pa4;const o=new i._12(1e5,1e5);p=new c.B(o,{textureWidth:512,textureHeight:512,waterNormals:(new i.dpR).load("assets/waternormals.jpg",(function(e){e.wrapS=e.wrapT=i.rpg})),sunDirection:new i.Pa4,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==f.fog}),p.rotation.x=-Math.PI/2,f.add(p);const m=new d.q;m.scale.setScalar(1e4),f.add(m);const x=m.material.uniforms;x.turbidity.value=10,x.rayleigh.value=2,x.mieCoefficient.value=.005,x.mieDirectionalG.value=.8;const k=new i.anP(g);let D;"resVis"===h.f.environment&&(x.mieCoefficient.value=.8,x.mieDirectionalG.value=.5,f.fog=new i.ybr(4737097,1e3,1100),M.elevation=55.23),function(){const e=i.M8C.degToRad(90-M.elevation),n=i.M8C.degToRad(M.azimuth);b.setFromSphericalCoords(1,e,n),m.material.uniforms.sunPosition.value.copy(b),p.material.uniforms.sunDirection.value.copy(b).normalize(),p.material.blendDst=2,void 0!==D&&D.dispose(),D=k.fromScene(m),f.environment=D.texture}(),P=new r.m(new i.FM8(window.innerWidth,window.innerHeight),1.5,.4,.85),P.threshold=0,P.strength=5,P.radius=1,C=new a.x(g),C.renderToScreen=!1,C.addPass(t),C.addPass(P),S=new l.T(new i.jyz({uniforms:{baseTexture:{value:null},bloomTexture:{value:C.renderTarget2.texture}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,defines:{}}),"baseTexture"),S.needsSwap=!0,y=new a.x(g),y.addPass(t),y.addPass(S),window.addEventListener("resize",(()=>{g.setSize(window.innerWidth,window.innerHeight),v.aspect=window.innerWidth/window.innerHeight,v.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight)})),window.addEventListener("orientationchange",(()=>{g.setSize(window.innerWidth,window.innerHeight),v.aspect=window.innerWidth/window.innerHeight,v.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight)})),w("#course-display").append(`<p>${u.UN(u.v2(h.a6[0].vector.angle).toFixed(1))}&deg;</p>`),w("#speed-display").append(`<p>${h.a6[0].speed.toFixed(1)} Kts</p>`),e("success"),n("Error during intialization"),console.log(f)}));(async()=>{try{await Promise.all([e,n]),function(e){e||f.traverse((e=>{e.name.includes("light")&&(e.visible=!1)}))}(z),$(),w(".threeOverlay").hide()}catch(e){console.log(e)}})()}function $(){if(requestAnimationFrame($),!0===h.f.play&&(x=Date.now(),N=x-k,N>D&&(k=x-N%D,(0,h._l)(D),w("#lookOut").is(":visible")))){z&&X(),performance.now(),p.material.uniforms&&(p.material.uniforms.time.value+=1/60),g.render(f,v),X(),y.render(),W?(v.fov=20,v.updateProjectionMatrix()):(v.fov=45,v.updateProjectionMatrix()),v.rotation.y+=I,function(){let e=new i.Pa4;v.getWorldDirection(e);let n=Math.atan2(e.z,e.x)+Math.PI/2;n<0&&(n+=2*Math.PI),Y=Math.round(180*n/Math.PI);let t=[n-.035,n-.0175,n,n+.0175,n+.035];t.forEach((function(e,n){e<0&&(e+=2*Math.PI);let i=Math.round(180*e/Math.PI);t[n]=u.UN(i)})),w("#orientator").css("transform","rotate("+t[2]+"deg)"),w("#vis-bearing").text(""),t[2]="<span id=fcsBrng>"+t[2]+"</span>",w("#vis-bearing").append(t.join("  "))}();for(let e=2;e<f.children.length;e++){if(f.children[e].name.startsWith("00")){let n=f.children[e].name,t=G(n);if(f.children[e].position.set(J(h.a6[t].relposXnm),0,J(h.a6[t].relposYnm)),z&&A(t,f.children[e]),q(t,f.children[e]),n="003"){const n=f.children[e].children[f.children[e].children.length-1];0==n.isPlaying&&n.play()}}if(h.NC&&"buoys"==f.children[e].name)for(let n=0;n<f.children[e].children.length;n++){const t=f.children[e].children[n].number;f.children[e].children[n].name.startsWith("port")?Math.sqrt(Math.pow(h.NC.markers.relPositionsPort[t].x,2)+Math.pow(h.NC.markers.relPositionsPort[t].y,2))>11?f.children[e].children[n].visible=!1:(f.children[e].children[n].visible=!0,f.children[e].children[n].position.set(J(h.NC.markers.relPositionsPort[t].x),0,J(h.NC.markers.relPositionsPort[t].y))):f.children[e].children[n].name.startsWith("starboard")&&(Math.sqrt(Math.pow(h.NC.markers.relPositionsStarboard[t].x,2)+Math.pow(h.NC.markers.relPositionsStarboard[t].y,2))>11?f.children[e].children[n].visible=!1:(f.children[e].children[n].visible=!0,f.children[e].children[n].position.set(J(h.NC.markers.relPositionsStarboard[t].x),0,J(h.NC.markers.relPositionsStarboard[t].y)))),1==f.children[e].children[n].visible&&z&&U(f.children[e].children[n])}}}}function q(e,n){h.a6[e].range>11?n.visible=!1:n.visible=!0}function A(e,n){const t=h.a6[e].USNRel;n.traverse((e=>{e.name.includes("SG")&&(t>0&&t<112.5||t>354&&t<360)&&(e.visible=!0),e.name.includes("SG")&&t>112.5&&t<354&&(e.visible=!1),e.name.includes("SR")&&(t>247.5&&t<360||t>0&&t<4)&&(e.visible=!0),e.name.includes("SR")&&t>4&&t<247.5&&(e.visible=!1),e.name.includes("MH")&&(t>247.5&&t<360||t>0&&t<112.5)&&(e.visible=!0),e.name.includes("MH")&&t>112.5&&t<247.5&&(e.visible=!1),e.name.includes("STRN")&&t>112.5&&t<247.5&&(e.visible=!0),e.name.includes("STRN")&&t>0&&t<112.5&&(e.visible=!1),e.name.includes("STRN")&&t>247.5&&t<360&&(e.visible=!1)}))}function G(e){return h.a6.findIndex((function(n){return n.name==e}))}function U(e){e.lastSwitch||function(e){const n=Math.random()*T;e.lastSwitch=Date.now()-n}(e);const n=Date.now()-e.lastSwitch;e.lightOn&&n>e.flashLength?e.traverse((n=>{n.name.includes("light")&&(n.visible=!1),e.lightOn=!1,e.lastSwitch=Date.now()})):!e.lightOn&&n>e.flashInterval&&e.traverse((n=>{n.name.includes("light")&&(n.visible=!0),e.lightOn=!0,e.lastSwitch=Date.now()}))}let Y="";function J(e){return 1e3*e}function X(e){f.traverse(K),C.render(),f.traverse(Z)}function K(e){e.isMesh&&!e.name.includes("light")&&(R[e.uuid]=e.material,e.material=H)}function Z(e){R[e.uuid]&&(e.material=R[e.uuid],delete R[e.uuid])}const Q=function(e){return B[e]};w((function(){w("#zoom-view").on("touchstart mousedown",(function(){W=!0,w("#zoom-view").addClass("view-selected"),w("#eye-view").removeClass("view-selected"),w("#compass-view").removeClass("view-selected"),w("#compass-cont").is(":visible")&&w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")||w("#instrument-panel").toggle(),w("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),w("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),w("#eye-view").on("touchstart mousedown",(function(){W=!1,w("#eye-view").addClass("view-selected"),w("#zoom-view").removeClass("view-selected"),w("#compass-view").removeClass("view-selected"),w("#compass-cont").is(":visible")&&w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")||w("#instrument-panel").toggle(),w("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),w("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),w("#compass-view").on("touchstart mousedown",(function(){W=!1,w("#eye-view").removeClass("view-selected"),w("#zoom-view").removeClass("view-selected"),w("#compass-view").addClass("view-selected"),w("#compass-cont").is(":visible")||w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")&&w("#instrument-panel").toggle(),ne(!0),w("#left-arrow i").addClass("fa-regular fa-chevron-left").removeClass("fa-duotone fa-chevrons-left"),w("#right-arrow i").addClass("fa-regular fa-chevron-right").removeClass("fa-duotone fa-chevrons-right")})),w("#left-arrow").on("hover",(function(e){w(this).css("color","rgba(255, 255, 255, 1)")}),(function(){w(this).css("color","rgba(255, 255, 255, 0.75)")})),w("#left-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),w("#compass-cont").is(":visible")?(I=9e-4,ne()):I=.01,w(this).css("color","rgba(255, 255, 255, 1)")})),w("#left-arrow").on("touchend mouseup",(function(e){e.preventDefault(),I=0,w(this).css("color","rgba(255, 255, 255, 0.75)")})),w(document).on("keydown",(function(e){37==e.which&&(w("#compass-cont").is(":visible")?(I=9e-4,ne()):I=.01)})),w(document).on("keyup",(function(e){37==e.which&&(I=0)})),w("#right-arrow").on("hover",(function(e){w(this).css("color","rgba(255, 255, 255, 1)")}),(function(){w(this).css("color","rgba(255, 255, 255, 0.75)")})),w("#right-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),w("#compass-cont").is(":visible")?(I=-9e-4,ne()):I=-.01,w(this).css("color","rgba(255, 255, 255, 1)")})),w("#right-arrow").on("touchend mouseup",(function(e){e.preventDefault(),I=0,w(this).css("color","rgba(255, 255, 255, 0.75)")})),w(document).on("keydown",(function(e){39==e.which&&(w("#compass-cont").is(":visible")?(I=-9e-4,ne()):I=-.01)})),w(document).on("keyup",(function(e){39==e.which&&(I=0)})),w("#lookout-button").on("touchstart mousedown",(function(){ne(),console.log("Fired play audio"),f.traverse((e=>{"Audio"==e.type&&(console.log(e),e.context.resume())}))}))}));let ee="";const ne=function(e){const n=ee;ee=Date.now();const t=ee-n;h.a6.slice(1).forEach((i=>{const o=Math.abs(u.v2(Math.round(i.vecOwnShip.angle))-Y);t>1e3&&o<3&&(console.log(`bearingDiff = ${o} | dwellTime = ${t} |  actualBearing = ${i.bearing}`),i.bearingsTaken.push(n)),e&&o<4&&i.bearingsTaken.push(ee)}))}}}]);
//# sourceMappingURL=646.bundle.js.map