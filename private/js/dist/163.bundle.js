"use strict";(self.webpackChunkdaily_scenarios_sender=self.webpackChunkdaily_scenarios_sender||[]).push([[163],{3163:(e,n,i)=>{i.r(n),i.d(n,{buildThreeDRendering:()=>j});var o=i(9477),t=i(3867),s=i(4458),a=i(5786),r=i(5484),l=i(7531),c=i(3660),d=i(2644),u=i(2535),w=i(9755);let h,f,m,v,g,p,b,y,C;const P={elevation:0,azimuth:90};let M,S=Date.now();const x=1e3/30;let z,D=!1,T=0;const k=new o.vBJ({color:"black"}),A={};f=new o.xsS,h=new o.cPb(55,window.innerWidth/window.innerHeight,1,2e4),h.position.set(30,30,100);const H=new o.mTL,R=new o.SJI;h.add(R);var I=new t.E;const W={PDV:"/assets/pdv-fog-signal.mp3",SV:"/assets/lame-duck-fog-signal.mp3",VEIF:"/assets/lame-duck-fog-signal.mp3",NUC:"/assets/lame-duck-fog-signal.mp3",RAM:"/assets/lame-duck-fog-signal.mp3",anchorless100m:"/assets/at-anchor-less-than-100m.mp3"},E=(e,n,i,t,s,a)=>new Promise(((r,l)=>{I.load(e,(function(e){let l=e.scene;l.position.set(G(n),0,G(i)),l.rotation.y=-t,l.name=s,window.resVis?H.load(X(a),(function(e){const n=new o.VYz(R);n.setBuffer(e),n.setRefDistance(10),n.setLoop(!0),"PDV"==a&&(n.offset=Math.random()),l.add(n),f.add(l)})):f.add(l),r("success")}),void 0,(function(e){l(e)}))}));function j(){h.rotation.y=-window.shipsAfloat[0].course-Math.PI/2,w("#base-wrapper").css("transform","rotate("+Math.round(180*shipsAfloat[0].course/Math.PI+90)+"deg)"),P.elevation=window.elevation;const e=new Promise(((e,n)=>{(async()=>{try{const n=[];window.shipsAfloat.slice(1).forEach((e=>{n.push(E("/assets/"+e.type+".glb",e.relposXnm,e.relposYnm,e.course,e.name,e.type))}));const i=await Promise.all(n);e(i)}catch(e){n(e)}})()})),n=new Promise(((e,n)=>{m=new o.CP7({canvas:ThreeDcanvas}),m.setPixelRatio(window.devicePixelRatio),m.setSize(window.innerWidth,window.innerHeight),m.toneMapping=o.LY2,f=new o.xsS;const i=new s.C(f,h);g=new o.Pa4;const t=new o._12(1e5,1e5);v=new c.B(t,{textureWidth:512,textureHeight:512,waterNormals:(new o.dpR).load("/assets/waternormals.jpg",(function(e){e.wrapS=e.wrapT=o.rpg})),sunDirection:new o.Pa4,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==f.fog}),v.rotation.x=-Math.PI/2,f.add(v);const u=new d.q;u.scale.setScalar(1e4),f.add(u);const M=u.material.uniforms;M.turbidity.value=10,M.rayleigh.value=2,M.mieCoefficient.value=.005,M.mieDirectionalG.value=.8;const S=new o.anP(m);let x;window.resVis&&(M.mieCoefficient.value=.8,M.mieDirectionalG.value=.5,f.fog=new o.ybr(4737097,1e3,1100),P.elevation=55.23),function(){const e=o.M8C.degToRad(90-P.elevation),n=o.M8C.degToRad(P.azimuth);g.setFromSphericalCoords(1,e,n),u.material.uniforms.sunPosition.value.copy(g),v.material.uniforms.sunDirection.value.copy(g).normalize(),v.material.blendDst=2,void 0!==x&&x.dispose(),x=S.fromScene(u),f.environment=x.texture}(),p=new r.m(new o.FM8(window.innerWidth,window.innerHeight),1.5,.4,.85),p.threshold=0,p.strength=5,p.radius=1,b=new a.x(m),b.renderToScreen=!1,b.addPass(i),b.addPass(p),C=new l.T(new o.jyz({uniforms:{baseTexture:{value:null},bloomTexture:{value:b.renderTarget2.texture}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,defines:{}}),"baseTexture"),C.needsSwap=!0,y=new a.x(m),y.addPass(i),y.addPass(C),window.addEventListener("resize",(()=>{m.setSize(window.innerWidth,window.innerHeight),h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight)})),window.addEventListener("orientationchange",(()=>{m.setSize(window.innerWidth,window.innerHeight),h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight)})),w("#course-display").append(`<p>${L(window.convertAngle(window.shipsAfloat[0].vector.angle).toFixed(1))}&deg;</p>`),w("#speed-display").append(`<p>${window.shipsAfloat[0].speed.toFixed(1)} Kts</p>`),e("success"),n("Error during intialization"),console.log(f)}));(async()=>{try{await Promise.all([e,n]),_(P.elevation),B(),w(".threeOverlay").hide(),console.log(f)}catch(e){console.log(e)}})()}function B(){if(requestAnimationFrame(B),!0===window.play&&(M=Date.now(),z=M-S,z>x&&(S=M-z%x,(0,u._l)(x),w("#lookOut").is(":visible")))){O(),performance.now(),v.material.uniforms&&(v.material.uniforms.time.value+=1/60),m.render(f,h),O(),y.render(),D?(h.fov=20,h.updateProjectionMatrix()):(h.fov=45,h.updateProjectionMatrix()),h.rotation.y+=T,function(){let e=new o.Pa4;h.getWorldDirection(e);let n=Math.atan2(e.z,e.x)+Math.PI/2;n<0&&(n+=2*Math.PI),$=Math.round(180*n/Math.PI);let i=[n-.035,n-.0175,n,n+.0175,n+.035];i.forEach((function(e,n){e<0&&(e+=2*Math.PI);let o=Math.round(180*e/Math.PI);i[n]=L(o)})),w("#orientator").css("transform","rotate("+i[2]+"deg)"),w("#vis-bearing").text(""),i[2]="<span id=fcsBrng>"+i[2]+"</span>",w("#vis-bearing").append(i.join("  "))}(),_(P.elevation);for(let e=2;e<f.children.length;e++){let n=f.children[e].name,i=N(n);if(f.children[e].position.set(G(window.shipsAfloat[i].relposXnm),0,G(window.shipsAfloat[i].relposYnm)),(P.elevation<2||P.elevation>178)&&V(i,f.children[e]),F(i,f.children[e]),n="003"){const n=f.children[e].children[f.children[e].children.length-1];0==n.isPlaying&&n.play()}}}}function F(e,n){window.shipsAfloat[e].range>11?n.visible=!1:n.visible=!0}function V(e,n){const i=window.shipsAfloat[e].USNRel;n.traverse((e=>{e.name.includes("SG")&&(i>0&&i<112.5||i>354&&i<360)&&(e.visible=!0),e.name.includes("SG")&&i>112.5&&i<354&&(e.visible=!1),e.name.includes("SR")&&(i>247.5&&i<360||i>0&&i<4)&&(e.visible=!0),e.name.includes("SR")&&i>4&&i<247.5&&(e.visible=!1),e.name.includes("MH")&&(i>247.5&&i<360||i>0&&i<112.5)&&(e.visible=!0),e.name.includes("MH")&&i>112.5&&i<247.5&&(e.visible=!1),e.name.includes("STRN")&&i>112.5&&i<247.5&&(e.visible=!0),e.name.includes("STRN")&&i>0&&i<112.5&&(e.visible=!1),e.name.includes("STRN")&&i>247.5&&i<360&&(e.visible=!1)}))}function N(e){return window.shipsAfloat.findIndex((function(n){return n.name==e}))}function _(e){f.traverse((n=>{n.name.includes("light")&&e>2&&e<178?n.visible=!1:n.name.includes("light")&&(n.visible=!0)}))}function L(e){return e>=100?e:e>9?"0"+e:"00"+e}let $="";function G(e){return 1e3*e}let Y=function(){const e=[0,1,2,3,4,20,21,22,23];return e[Math.floor(Math.random()*e.length)]}();function O(e){f.traverse(q),b.render(),f.traverse(J)}function q(e){e.isMesh&&!e.name.includes("light")&&(A[e.uuid]=e.material,e.material=k)}function J(e){A[e.uuid]&&(e.material=A[e.uuid],delete A[e.uuid])}var U;(U=Y)<10&&(U="0"+U),Y=U;const X=function(e){return W[e]};w((function(){w("#zoom-view").on("touchstart mousedown",(function(){D=!0,w("#zoom-view").addClass("view-selected"),w("#eye-view").removeClass("view-selected"),w("#compass-view").removeClass("view-selected"),w("#compass-cont").is(":visible")&&w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")||w("#instrument-panel").toggle(),w("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),w("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),w("#eye-view").on("touchstart mousedown",(function(){D=!1,w("#eye-view").addClass("view-selected"),w("#zoom-view").removeClass("view-selected"),w("#compass-view").removeClass("view-selected"),w("#compass-cont").is(":visible")&&w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")||w("#instrument-panel").toggle(),w("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),w("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),w("#compass-view").on("touchstart mousedown",(function(){D=!1,w("#eye-view").removeClass("view-selected"),w("#zoom-view").removeClass("view-selected"),w("#compass-view").addClass("view-selected"),w("#compass-cont").is(":visible")||w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")&&w("#instrument-panel").toggle(),Q(!0),w("#left-arrow i").addClass("fa-regular fa-chevron-left").removeClass("fa-duotone fa-chevrons-left"),w("#right-arrow i").addClass("fa-regular fa-chevron-right").removeClass("fa-duotone fa-chevrons-right")})),w("#left-arrow").on("hover",(function(e){w(this).css("color","rgba(255, 255, 255, 1)")}),(function(){w(this).css("color","rgba(255, 255, 255, 0.75)")})),w("#left-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),w("#compass-cont").is(":visible")?(T=9e-4,Q()):T=.01,w(this).css("color","rgba(255, 255, 255, 1)")})),w("#left-arrow").on("touchend mouseup",(function(e){e.preventDefault(),T=0,w(this).css("color","rgba(255, 255, 255, 0.75)")})),w(document).on("keydown",(function(e){37==e.which&&(w("#compass-cont").is(":visible")?(T=9e-4,Q()):T=.01)})),w(document).on("keyup",(function(e){37==e.which&&(T=0)})),w("#right-arrow").on("hover",(function(e){w(this).css("color","rgba(255, 255, 255, 1)")}),(function(){w(this).css("color","rgba(255, 255, 255, 0.75)")})),w("#right-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),w("#compass-cont").is(":visible")?(T=-9e-4,Q()):T=-.01,w(this).css("color","rgba(255, 255, 255, 1)")})),w("#right-arrow").on("touchend mouseup",(function(e){e.preventDefault(),T=0,w(this).css("color","rgba(255, 255, 255, 0.75)")})),w(document).on("keydown",(function(e){39==e.which&&(w("#compass-cont").is(":visible")?(T=-9e-4,Q()):T=-.01)})),w(document).on("keyup",(function(e){39==e.which&&(T=0)})),w("#lookout-button").on("touchstart mousedown",(function(){Q(),console.log("Fired play audio"),f.traverse((e=>{"Audio"==e.type&&(console.log(e),e.context.resume())}))}))}));let K="";const Q=function(e){const n=K;K=Date.now();const i=K-n;window.shipsAfloat.slice(1).forEach((o=>{const t=Math.abs(convertAngle(Math.round(o.vecOwnShip.angle))-$);i>1e3&&t<3&&(console.log(`bearingDiff = ${t} | dwellTime = ${i} |  actualBearing = ${o.bearing}`),o.bearingsTaken.push(n)),e&&t<4&&o.bearingsTaken.push(K)}))}}}]);
//# sourceMappingURL=163.bundle.js.map