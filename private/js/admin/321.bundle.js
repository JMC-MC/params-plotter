"use strict";(self.webpackChunkdaily_scenarios_sender=self.webpackChunkdaily_scenarios_sender||[]).push([[321],{321:(e,n,i)=>{i.r(n),i.d(n,{buildThreeDRendering:()=>V});var o=i(477),t=i(867),s=i(458),a=i(786),r=i(484),l=i(531),c=i(660),d=i(644),u=i(709),w=i(755);let h,v,f,m,g,p,b,y,C;const P={elevation:0,azimuth:90};let x,M=Date.now();const S=1e3/30;let D,T=!1,z=0;const k="varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );}",A="uniform sampler2D baseTexture;uniform sampler2D bloomTexture;varying vec2 vUv;void main() {gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );}",H=new o.vBJ({color:"black"}),R={};v=new o.xsS,h=new o.cPb(55,window.innerWidth/window.innerHeight,1,2e4),h.position.set(30,30,100);const W=new o.mTL,I=new o.SJI;h.add(I);var j=new t.E;const E={PDV:"assets/pdv-fog-signal.mp3",SV:"assets/lame-duck-fog-signal.mp3",VEIF:"assets/lame-duck-fog-signal.mp3",NUC:"assets/lame-duck-fog-signal.mp3",RAM:"assets/lame-duck-fog-signal.mp3",anchorless100m:"assets/at-anchor-less-than-100m.mp3"},F=(e,n,i,t,s,a)=>new Promise(((r,l)=>{j.load(e,(function(e){let l=e.scene;l.position.set(Y(n),0,Y(i)),l.rotation.y=-t,l.name=s,window.resVis?W.load(Q(a),(function(e){const n=new o.VYz(I);n.setBuffer(e),n.setRefDistance(10),n.setLoop(!0),"PDV"==a&&(n.offset=Math.random()),l.add(n),v.add(l)})):v.add(l),r("success")}),void 0,(function(e){l(e)}))}));function V(){h.rotation.y=-window.shipsAfloat[0].course-Math.PI/2,w("#base-wrapper").css("transform","rotate("+Math.round(180*shipsAfloat[0].course/Math.PI+90)+"deg)"),P.elevation=window.elevation;const e=new Promise(((e,n)=>{(async()=>{try{const n=[];window.shipsAfloat.slice(1).forEach((e=>{n.push(F("assets/"+e.type+".glb",e.relposXnm,e.relposYnm,e.course,e.name,e.type))}));const i=await Promise.all(n);e(i)}catch(e){n(e)}})()})),n=new Promise(((e,n)=>{f=new o.CP7({canvas:ThreeDcanvas}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.toneMapping=o.LY2,v=new o.xsS;const i=new s.C(v,h);g=new o.Pa4;const t=new o._12(1e5,1e5);m=new c.B(t,{textureWidth:512,textureHeight:512,waterNormals:(new o.dpR).load("assets/waternormals.jpg",(function(e){e.wrapS=e.wrapT=o.rpg})),sunDirection:new o.Pa4,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==v.fog}),m.rotation.x=-Math.PI/2,v.add(m);const u=new d.q;u.scale.setScalar(1e4),v.add(u);const x=u.material.uniforms;x.turbidity.value=10,x.rayleigh.value=2,x.mieCoefficient.value=.005,x.mieDirectionalG.value=.8;const M=new o.anP(f);let S;window.resVis&&(x.mieCoefficient.value=.8,x.mieDirectionalG.value=.5,v.fog=new o.ybr(4737097,1e3,1100),P.elevation=55.23),function(){const e=o.M8C.degToRad(90-P.elevation),n=o.M8C.degToRad(P.azimuth);g.setFromSphericalCoords(1,e,n),u.material.uniforms.sunPosition.value.copy(g),m.material.uniforms.sunDirection.value.copy(g).normalize(),m.material.blendDst=2,void 0!==S&&S.dispose(),S=M.fromScene(u),v.environment=S.texture}(),p=new r.m(new o.FM8(window.innerWidth,window.innerHeight),1.5,.4,.85),p.threshold=0,p.strength=5,p.radius=1,b=new a.x(f),b.renderToScreen=!1,b.addPass(i),b.addPass(p),C=new l.T(new o.jyz({uniforms:{baseTexture:{value:null},bloomTexture:{value:b.renderTarget2.texture}},vertexShader:k,fragmentShader:A,defines:{}}),"baseTexture"),C.needsSwap=!0,y=new a.x(f),y.addPass(i),y.addPass(C),window.addEventListener("resize",(()=>{f.setSize(window.innerWidth,window.innerHeight),h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight)})),window.addEventListener("orientationchange",(()=>{f.setSize(window.innerWidth,window.innerHeight),h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight)})),w("#course-display").append(`<p>${$(window.convertAngle(window.shipsAfloat[0].vector.angle).toFixed(1))}&deg;</p>`),w("#speed-display").append(`<p>${window.shipsAfloat[0].speed.toFixed(1)} Kts</p>`),e("success"),n("Error during intialization"),console.log(v)}));(async()=>{try{await Promise.all([e,n]),L(P.elevation),_(),w(".threeOverlay").hide(),console.log(v)}catch(e){console.log(e)}})()}function _(){if(requestAnimationFrame(_),!0===window.play&&(x=Date.now(),D=x-M,D>S&&(M=x-D%S,(0,u._l)(S),w("#lookOut").is(":visible")))){q(),performance.now(),m.material.uniforms&&(m.material.uniforms.time.value+=1/60),f.render(v,h),q(),y.render(),T?(h.fov=20,h.updateProjectionMatrix()):(h.fov=45,h.updateProjectionMatrix()),h.rotation.y+=z,function(){let e=new o.Pa4;h.getWorldDirection(e);let n=Math.atan2(e.z,e.x)+Math.PI/2;n<0&&(n+=2*Math.PI),G=Math.round(180*n/Math.PI);let i=[n-.035,n-.0175,n,n+.0175,n+.035];i.forEach((function(e,n){e<0&&(e+=2*Math.PI);let o=Math.round(180*e/Math.PI);i[n]=$(o)})),w("#orientator").css("transform","rotate("+i[2]+"deg)"),w("#vis-bearing").text(""),i[2]="<span id=fcsBrng>"+i[2]+"</span>",w("#vis-bearing").append(i.join("  "))}(),L(P.elevation);for(let e=2;e<v.children.length;e++){let n=v.children[e].name,i=B(n);if(v.children[e].position.set(Y(window.shipsAfloat[i].relposXnm),0,Y(window.shipsAfloat[i].relposYnm)),(P.elevation<2||P.elevation>178)&&N(i,v.children[e]),U(i,v.children[e]),n="003"){const n=v.children[e].children[v.children[e].children.length-1];0==n.isPlaying&&n.play()}}}}function U(e,n){window.shipsAfloat[e].range>11?n.visible=!1:n.visible=!0}function N(e,n){const i=window.shipsAfloat[e].USNRel;n.traverse((e=>{e.name.includes("SG")&&(i>0&&i<112.5||i>354&&i<360)&&(e.visible=!0),e.name.includes("SG")&&i>112.5&&i<354&&(e.visible=!1),e.name.includes("SR")&&(i>247.5&&i<360||i>0&&i<4)&&(e.visible=!0),e.name.includes("SR")&&i>4&&i<247.5&&(e.visible=!1),e.name.includes("MH")&&(i>247.5&&i<360||i>0&&i<112.5)&&(e.visible=!0),e.name.includes("MH")&&i>112.5&&i<247.5&&(e.visible=!1),e.name.includes("STRN")&&i>112.5&&i<247.5&&(e.visible=!0),e.name.includes("STRN")&&i>0&&i<112.5&&(e.visible=!1),e.name.includes("STRN")&&i>247.5&&i<360&&(e.visible=!1)}))}function B(e){return window.shipsAfloat.findIndex((function(n){return n.name==e}))}function L(e){v.traverse((n=>{n.name.includes("light")&&e>2&&e<178?n.visible=!1:n.name.includes("light")&&(n.visible=!0)}))}function $(e){return e>=100?e:e>9?"0"+e:"00"+e}let G="";function Y(e){return 1e3*e}let O=function(){const e=[0,1,2,3,4,20,21,22,23];return e[Math.floor(Math.random()*e.length)]}();function q(e){v.traverse(J),b.render(),v.traverse(X)}function J(e){e.isMesh&&!e.name.includes("light")&&(R[e.uuid]=e.material,e.material=H)}function X(e){R[e.uuid]&&(e.material=R[e.uuid],delete R[e.uuid])}var K;(K=O)<10&&(K="0"+K),O=K;const Q=function(e){return E[e]};w((function(){w("#zoom-view").on("touchstart mousedown",(function(){T=!0,w("#zoom-view").addClass("view-selected"),w("#eye-view").removeClass("view-selected"),w("#compass-view").removeClass("view-selected"),w("#compass-cont").is(":visible")&&w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")||w("#instrument-panel").toggle(),w("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),w("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),w("#eye-view").on("touchstart mousedown",(function(){T=!1,w("#eye-view").addClass("view-selected"),w("#zoom-view").removeClass("view-selected"),w("#compass-view").removeClass("view-selected"),w("#compass-cont").is(":visible")&&w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")||w("#instrument-panel").toggle(),w("#left-arrow i").addClass("fa-duotone fa-chevrons-left").removeClass("fa-regular fa-chevron-left"),w("#right-arrow i").addClass("fa-duotone fa-chevrons-right").removeClass("fa-regular fa-chevron-right")})),w("#compass-view").on("touchstart mousedown",(function(){T=!1,w("#eye-view").removeClass("view-selected"),w("#zoom-view").removeClass("view-selected"),w("#compass-view").addClass("view-selected"),w("#compass-cont").is(":visible")||w("#compass-cont").toggle(),w("#instrument-panel").is(":visible")&&w("#instrument-panel").toggle(),ee(!0),w("#left-arrow i").addClass("fa-regular fa-chevron-left").removeClass("fa-duotone fa-chevrons-left"),w("#right-arrow i").addClass("fa-regular fa-chevron-right").removeClass("fa-duotone fa-chevrons-right")})),w("#left-arrow").on("hover",(function(e){w(this).css("color","rgba(255, 255, 255, 1)")}),(function(){w(this).css("color","rgba(255, 255, 255, 0.75)")})),w("#left-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),w("#compass-cont").is(":visible")?(z=9e-4,ee()):z=.01,w(this).css("color","rgba(255, 255, 255, 1)")})),w("#left-arrow").on("touchend mouseup",(function(e){e.preventDefault(),z=0,w(this).css("color","rgba(255, 255, 255, 0.75)")})),w(document).on("keydown",(function(e){37==e.which&&(w("#compass-cont").is(":visible")?(z=9e-4,ee()):z=.01)})),w(document).on("keyup",(function(e){37==e.which&&(z=0)})),w("#right-arrow").on("hover",(function(e){w(this).css("color","rgba(255, 255, 255, 1)")}),(function(){w(this).css("color","rgba(255, 255, 255, 0.75)")})),w("#right-arrow").on("touchstart mousedown",(function(e){e.preventDefault(),w("#compass-cont").is(":visible")?(z=-9e-4,ee()):z=-.01,w(this).css("color","rgba(255, 255, 255, 1)")})),w("#right-arrow").on("touchend mouseup",(function(e){e.preventDefault(),z=0,w(this).css("color","rgba(255, 255, 255, 0.75)")})),w(document).on("keydown",(function(e){39==e.which&&(w("#compass-cont").is(":visible")?(z=-9e-4,ee()):z=-.01)})),w(document).on("keyup",(function(e){39==e.which&&(z=0)})),w("#lookout-button").on("touchstart mousedown",(function(){ee(),console.log("Fired play audio"),v.traverse((e=>{"Audio"==e.type&&(console.log(e),e.context.resume())}))}))}));let Z="";const ee=function(e){const n=Z;Z=Date.now();const i=Z-n;window.shipsAfloat.slice(1).forEach((o=>{const t=Math.abs(convertAngle(Math.round(o.vecOwnShip.angle))-G);i>1e3&&t<3&&(console.log(`bearingDiff = ${t} | dwellTime = ${i} |  actualBearing = ${o.bearing}`),o.bearingsTaken.push(n)),e&&t<4&&o.bearingsTaken.push(Z)}))}}}]);
//# sourceMappingURL=321.bundle.js.map